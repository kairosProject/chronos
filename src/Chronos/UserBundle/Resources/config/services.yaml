services:
    # default configuration for services in *this* file
    _defaults:
        autowire: false
        autoconfigure: false
        public: false

    UserRepository:
        class: Doctrine\ODM\MongoDB\DocumentRepository
        factory: ['@doctrine_mongodb.odm.document_manager', getRepository]
        arguments:
            - "ChronosUserBundle:SimpleUser"
    UserProvider:
        class: Chronos\ApiBundle\Provider\GenericDocumentProvider
        arguments:
            - "@UserRepository"
            - "@logger"
    UserSerializer:
        class: Chronos\ApiBundle\Formatter\GenericEventDataFormatter
        arguments:
            - "@api.serializer"
            - "json"
            - "@api.response_factory.json"
            - "@logger"
            - {isJson: true}
            - {groups: ['user.id', 'user.username', 'user.roles', 'role.id']}
    UserDispatcher:
        class: Symfony\Component\EventDispatcher\EventDispatcher
        calls:
            - ['addListener', [!php/const Chronos\ApiBundle\Event\ApiControllerEventInterface::EVENT_GET_MULTIPLE, ['@UserProvider', 'provideDocuments'], 10]]
            - ['addListener', [!php/const Chronos\ApiBundle\Event\ApiControllerEventInterface::EVENT_GET_MULTIPLE, ['@UserSerializer', 'format'], 0]]
    UserController:
        class: Chronos\UserBundle\Controller\SimpleUserController
        arguments:
            - "@UserDispatcher"
        public: true
